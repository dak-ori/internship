<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Web Image Map with Info Panel</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: #f8f9fa;
        overflow-x: hidden;
      }

      .main-container {
        display: flex;
        height: 100vh;
        width: 100vw;
        align-items: center;
        justify-content: center;
        padding: 20px;
        background: #f8f9fa;
      }

      .image-section {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #container {
        position: relative;
        display: inline-block;
        max-width: 70vw;
        max-height: 90vh;
      }

      img {
        width: 100%;
        height: auto;
        display: block;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      area {
        cursor: pointer;
      }

      /* 정보 패널 */
      .info-panel {
        background: white;
        border-left: 1px solid #e5e7eb;
        display: flex;
        flex-direction: column;
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 10;
        margin-left: 20px;
        border-radius: 12px;
        overflow: hidden;
        min-height: 400px;
        align-self: flex-start;
        width: 400px;
        max-height: 90vh;
      }

      .panel-header {
        padding: 24px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8f9fa;
        position: relative;
      }

      .panel-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        background: white;
      }

      .panel-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: #6b7280;
        text-align: center;
        padding: 40px 20px;
      }

      .panel-placeholder h3 {
        margin: 16px 0 8px 0;
        color: #374151;
        font-size: 18px;
        font-weight: 600;
      }

      .panel-placeholder p {
        font-size: 14px;
        line-height: 1.6;
        opacity: 0.8;
      }

      .modal-title {
        font-size: 24px;
        font-weight: bold;
        color: #1f2937;
        margin: 0;
      }

      .modal-close {
        position: absolute;
        top: 24px;
        right: 24px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #6b7280;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        transition: background 0.2s;
      }

      .modal-close:hover {
        background: #f3f4f6;
      }

      .modal-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 12px;
        margin-bottom: 16px;
      }

      .modal-description {
        color: #6b7280;
        margin-bottom: 20px;
        line-height: 1.6;
        font-size: 15px;
      }

      .modal-details {
        display: grid;
        gap: 12px;
      }

      .detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #f3f4f6;
      }

      .detail-label {
        font-weight: 600;
        color: #374151;
        font-size: 14px;
      }

      .detail-value {
        color: #6b7280;
        font-size: 14px;
        text-align: right;
        margin-left: 16px;
      }

      .modal-badge {
        display: inline-flex;
        align-items: center;
        padding: 6px 12px;
        background: #ddd6fe;
        color: #7c3aed;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        margin-bottom: 12px;
      }

      @media (max-width: 768px) {
        .main-container {
          flex-direction: column;
        }
        .info-panel {
          width: 100%;
          margin-left: 0;
          margin-top: 20px;
          border-left: none;
          border-top: 1px solid #e5e7eb;
        }
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <!-- 이미지 -->
      <div class="image-section">
        <div id="container">
          <img id="main-img" src="static/post.jpg" usemap="#map" alt="이미지맵" />
        </div>
        <map name="map" id="img-map"></map>
      </div>

      <!-- 사이드 정보 패널 -->
      <div id="info-panel" class="info-panel">
        <div class="panel-header">
          <div id="panel-badge" class="modal-badge" style="display: none"></div>
          <h2 id="panel-title" class="modal-title">정보 패널</h2>
          <button class="modal-close" onclick="closeInfoPanel()">×</button>
        </div>
        <div class="panel-content">
          <div id="panel-placeholder" class="panel-placeholder">
            <h3>정보를 확인하세요</h3>
            <p>이미지의 영역을 클릭하면<br />상세 정보가 여기에 표시됩니다.</p>
          </div>
          <div id="panel-info" style="display: none">
            <img id="panel-image" class="modal-image" style="display: none" />
            <p id="panel-description" class="modal-description"></p>
            <div id="panel-details" class="modal-details"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const jsonFilename = "static/post.json";

      const infoMapData = {
        넷플릭스: {
          type: "서비스",
          name: "넷플릭스",
          description: "전 세계 최대 규모의 스트리밍 플랫폼입니다.",
          image: "https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=400&h=200&fit=crop",
          details: {
            카테고리: "OTT 플랫폼",
            설립년도: "1997년",
            구독자수: "2억 3천만명",
            본사: "미국 캘리포니아",
          },
        },
        "폭삭 속았수다": {
          type: "콘텐츠",
          name: "폭삭 속았수다",
          description: "넷플릭스 오리지널 로맨틱 코미디 드라마.",
          image: "https://images.unsplash.com/photo-1489599809969-bba13d8d2dc3?w=400&h=200&fit=crop",
          details: {
            장르: "로맨틱 코미디",
            출연진: "김소현, 차은우",
            방영년도: "2023년",
            에피소드: "16부작",
          },
        },
        "공통 영역": {
          type: "전체",
          name: "전체 이미지",
          description: "지정된 영역 외의 공통 영역입니다.",
          image: "https://images.unsplash.com/photo-1495563381401-ecfbcaaa67e8?w=400&h=200&fit=crop",
          details: {
            용도: "배경 클릭",
            설명: "전체 이미지에서 다른 영역을 클릭하면 이 정보가 나타납니다.",
          },
        },
      };

      const defaultInfo = {
        type: "정보",
        name: "상세 정보",
        description: "이 영역에 대한 정보는 아직 준비되지 않았습니다.",
        details: {
          상태: "정보 없음",
          안내: "추후 업데이트 예정",
        },
      };

      const hardcodedRects = [
        {
          coords: [320, 1355, 540, 1420],
          alt: "넷플릭스",
          infoKey: "넷플릭스",
        },
        {
          coords: [180, 1175, 820, 1325],
          alt: "폭삭 속았수다",
          infoKey: "폭삭 속았수다",
        },
      ];

      function openInfoPanel(data) {
        document.getElementById("panel-title").textContent = data.name;
        document.getElementById("panel-description").textContent = data.description;

        const badge = document.getElementById("panel-badge");
        badge.textContent = data.type;
        badge.style.display = "inline-flex";

        const image = document.getElementById("panel-image");
        if (data.image) {
          image.src = data.image;
          image.style.display = "block";
        } else {
          image.style.display = "none";
        }

        const details = document.getElementById("panel-details");
        details.innerHTML = "";
        for (const [key, value] of Object.entries(data.details)) {
          const div = document.createElement("div");
          div.className = "detail-item";
          div.innerHTML = `<span class="detail-label">${key}</span><span class="detail-value">${value}</span>`;
          details.appendChild(div);
        }

        document.getElementById("panel-placeholder").style.display = "none";
        document.getElementById("panel-info").style.display = "block";
      }

      function closeInfoPanel() {
        document.getElementById("panel-placeholder").style.display = "flex";
        document.getElementById("panel-info").style.display = "none";
        document.getElementById("panel-badge").style.display = "none";
        document.getElementById("panel-title").textContent = "정보 패널";
      }

      fetch(jsonFilename)
        .then((res) => res.json())
        .then((data) => {
          const img = document.getElementById("main-img");
          const map = document.getElementById("img-map");

          function renderMap() {
            const w = img.clientWidth;
            const h = img.clientHeight;
            map.innerHTML = "";

            // JSON polygon
            data.forEach((polygon) => {
              const coords = polygon.coords.split(",").map(parseFloat);
              const absCoords = coords.map((val, i) => (i % 2 === 0 ? Math.round(val * w) : Math.round(val * h)));
              const area = document.createElement("area");
              area.shape = polygon.shape || "poly";
              area.coords = absCoords.join(",");
              area.alt = polygon.label || "영역";
              area.addEventListener("click", (e) => {
                e.preventDefault();
                const info = infoMapData[polygon.label] || defaultInfo;
                openInfoPanel(info);
              });
              map.appendChild(area);
            });

            // 하드코딩된 사각형
            hardcodedRects.forEach(({ coords, alt, infoKey }) => {
              const area = document.createElement("area");
              area.shape = "rect";
              area.coords = coords.join(",");
              area.alt = alt;
              area.addEventListener("click", (e) => {
                e.preventDefault();
                const info = infoMapData[infoKey] || defaultInfo;
                openInfoPanel(info);
              });
              map.appendChild(area);
            });

            // 전체 이미지 영역
            const fullArea = document.createElement("area");
            fullArea.shape = "rect";
            fullArea.coords = `0,0,${w},${h}`;
            fullArea.alt = "공통 영역";
            fullArea.addEventListener("click", (e) => {
              e.preventDefault();
              openInfoPanel(infoMapData["공통 영역"] || defaultInfo);
            });
            map.appendChild(fullArea);
          }

          img.onload = renderMap;
          if (img.complete) renderMap();
          window.addEventListener("resize", renderMap);
        })
        .catch((err) => console.error("JSON 로딩 실패:", err));

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeInfoPanel();
      });
    </script>
  </body>
</html>
