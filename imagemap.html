<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <style>
      img {
        max-width: 100%;
        height: auto;
        display: block;
      }
      area {
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <img id="main-img" src="static/net.jpg" usemap="#map" />
    <map name="map" id="img-map"></map>

    <script>
      const imageFilename = "static/net.jpg"; // 이미지 경로
      const jsonFilename = "json/net.json"; // JSON 경로 (경로 확인 필요)

      fetch(jsonFilename)
        .then((res) => res.json())
        .then((data) => {
          const img = document.getElementById("main-img");
          const map = document.getElementById("img-map");

          function renderMap() {
            map.innerHTML = ""; // 초기화
            const w = img.clientWidth;
            const h = img.clientHeight;

            data.forEach((polygon) => {
              const coords = polygon.coords.split(",").map(parseFloat);
              const absCoords = coords.map((val, i) => (i % 2 === 0 ? Math.round(val * w) : Math.round(val * h)));
              const area = document.createElement("area");
              area.shape = polygon.shape;
              area.coords = absCoords.join(",");
              area.href = "http://172.16.70.236:8080/?item=1"; // 실제 이동할 링크
              area.alt = polygon.label;
              area.target = "_blank"; // 새 창에서 열기
              map.appendChild(area);
            });
          }

          // 이미지가 로드됐는지 여부에 따라 바로 실행
          img.onload = renderMap;
          if (img.complete) {
            renderMap(); // 캐시된 경우도 대응
          }

          // 창 크기 변경 시 맵 재계산
          window.addEventListener("resize", renderMap);
        })
        .catch((err) => {
          console.error("JSON 로드 실패:", err);
        });
    </script>
  </body>
</html>
